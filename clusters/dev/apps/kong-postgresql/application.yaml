apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kong-postgresql
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "8"
    # NO finalizer â€” StatefulSet with PVC
spec:
  project: default
  source:
    repoURL: https://github.com/PilotDataPlatform/pilot-hdc-platform-gitops.git
    targetRevision: main
    path: clusters/dev/apps/kong-postgresql
    helm:
      valueFiles:
        - ../../registry.yaml
        # TODO: versions.yaml has pg_cron tag for main utility postgres only.
        # Proper fix: add postgresql-standard key to versions.yaml with standard
        # bitnami tag, then reference it here. For now, using chart default.
        # - ../../versions.yaml
        - values.yaml
  destination:
    server: https://kubernetes.default.svc
    namespace: utility
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
